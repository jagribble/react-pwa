const { injectManifest, copyWorkboxLibraries } = require('workbox-build');

// Copy workbox files at build time
copyWorkboxLibraries('./public/js/');

// We reuse the configuration from the file generated by Workbox CLI
const workboxConfig = require('../workbox-config.js');

// Adding one extra property - source service worker filename -
// with the possibility to pass it as an argument (for the next steps)
workboxConfig.swSrc = `ServiceWorker/${process.argv.slice(2)[0] || 'sw-default.js'}`;

// Deleting unneeded property
delete workboxConfig.runtimeCaching;

injectManifest(workboxConfig).then(({ count, size }) => {
  console.log(
    `Generated ${
      workboxConfig.swDest
    }, which will precache ${count} files, totaling ${size} bytes.`,
  );
});
